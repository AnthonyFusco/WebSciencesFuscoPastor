<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>WebSciencesUnice</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="js/SceneObject.js"></script>
  <script src="js/Player.js"></script>
  <script src="js/Sprite.js"></script>
  <script src="js/Main.js"></script>
  <script src="/socket.io/socket.io.js"></script>

  <script>
      var username = prompt("What's your name?");
      var conversation, data, datasend, users;
      var socket = io.connect();
      socket.on('connect', function(){
          socket.emit('adduser', username);
      });

      socket.on('updatechat', function (username, data) {
          var chatMessage = "<b>" + username + ":</b> " + data + "<br>";
          conversation.innerHTML += chatMessage;
      });

      socket.on('updateusers', function(listOfUsers) {
          users.innerHTML = "";
          for(var name in listOfUsers) {
              var userLineOfHTML = '<div>' + name + '</div>';
              users.innerHTML += userLineOfHTML;
          }
      });

      window.addEventListener("load", function(){
          conversation = document.querySelector("#conversation");
          data = document.querySelector("#data");
          datasend = document.querySelector("#datasend");
          users = document.querySelector("#users");

          datasend.addEventListener("click", function(evt) {
              sendMessage();
          });

          data.addEventListener("keypress", function(evt) {
              if(evt.keyCode == 13) {
                  this.blur();
                  sendMessage();
              }
          });

          function sendMessage() {
              var message = data.value;
              data.value = "";
              socket.emit('sendchat', message);
          }
      });

  </script>
</head>
<body>
  <canvas id="myCanvas" width=1900 height=900></canvas>
  <div style="float:left;width:100px;border-right:1px solid black;height:300px;padding:10px;scroll-y:overflow;">
    <b>USERS</b>
    <div id="users"></div>
  </div>
  <div style="float:left;width:300px;height:250px;scroll-y:overflow;padding:10px;">
    <div id="conversation"></div>
    <input id="data" style="width:200px;" />
    <input type="button" id="datasend" value="send" />
  </div>
</body>
</html>